# Integrated Multi-Agent Workflow Setup

This system integrates:
1. **Synthesis Architect** (Gemini) - Generates project proposals from Knowledge Graph
2. **LangGraph Manager** (DeepSeek via Fireworks) - Coordinates multi-agent ranking
3. **MongoDB Atlas** - Shared memory across all agents

## Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    MongoDB Atlas                             │
│  Collections: Knowledge_Graph, Project_Proposals,            │
│               Agent_State, sprint_contexts, ranked_projects  │
└─────────────────────────────────────────────────────────────┘
                ↑                              ↑
                │                              │
    ┌───────────┴────────┐        ┌───────────┴────────────┐
    │ Synthesis Architect │        │  LangGraph Manager     │
    │     (Gemini)        │───────→│     (DeepSeek)         │
    │                     │        │                        │
    │ - Watches KG        │        │ - Project Manager      │
    │ - Finds connections │        │ - Analyzer             │
    │ - Proposes projects │        │ - Ranker               │
    └─────────────────────┘        │ - Persistence          │
                                   └────────────────────────┘
```

## Quick Setup

### 1. Update `.env.local` with your credentials:

```bash
# MongoDB Atlas Connection
MONGODB_URI=mongodb+srv://<your_username>:<your_password>@cluster0.fim9iq.mongodb.net/?appName=Cluster0

# Fireworks AI (for DeepSeek)
FIREWORKS_API_KEY=fw_your_key_here

# Gemini API (for Synthesis Architect)
GEMINI_API_KEY=your_gemini_key_here
```

**To get your MongoDB credentials:**
1. Go to MongoDB Atlas: https://cloud.mongodb.com/
2. Navigate to your cluster: `cluster0.fim9iq.mongodb.net`
3. Click "Connect" → "Connect your application"
4. Copy the connection string
5. Replace `<db_username>` with your database username
6. Replace `<db_password>` with your database password

### 2. Install Python dependencies:

```bash
# Setup virtual environment
./setup_venv.sh

# Or manually:
source venv/bin/activate
pip install -r requirements.txt
```

### 3. Run the integrated workflow:

```bash
# Activate virtual environment
source venv/bin/activate

# Run integrated workflow (fetches from Synthesis Architect + LangGraph ranking)
python run_integrated_workflow.py
```

## How It Works

### Step 1: Synthesis Architect Generates Proposals

The Synthesis Architect watches the Knowledge Graph for new concepts and generates project proposals:

```bash
python backend/synthesis_architect.py
```

This agent:
- Monitors `Knowledge_Graph` collection for new concepts
- Finds "Conceptual Bridges" between related topics
- Generates unified project proposals using Gemini
- Saves proposals to `Project_Proposals` collection

### Step 2: LangGraph Manager Ranks Projects

The LangGraph workflow fetches proposals and ranks them:

```bash
python run_integrated_workflow.py
```

This workflow:
1. **Fetches** proposals from Synthesis Architect
2. **Project Manager** uses DeepSeek for strategic analysis
3. **Analyzer** evaluates each project with MongoDB context
4. **Ranker** synthesizes final rankings with DeepSeek
5. **Persistence** saves results back to MongoDB

## MongoDB Collections

### AcademicPlanner Database:
- `Knowledge_Graph` - Concepts and learning topics
- `Project_Proposals` - Generated by Synthesis Architect
- `Agent_State` - Agent internal monologue logs

### project-manager Database (LangGraph):
- `sprint_contexts` - Current sprint capacity/allocation
- `ranked_projects` - Final ranked project results

## API Keys Required

1. **MongoDB Atlas** (Free tier available)
   - Sign up: https://www.mongodb.com/cloud/atlas/register

2. **Fireworks AI** (For DeepSeek models)
   - Sign up: https://fireworks.ai/
   - Get API key from dashboard

3. **Google Gemini** (For Synthesis Architect)
   - Sign up: https://ai.google.dev/
   - Get API key from AI Studio

## Testing Components Individually

### Test MongoDB Connection:
```bash
source venv/bin/activate
python -c "from pymongo import MongoClient; import os; from dotenv import load_dotenv; load_dotenv('.env.local'); client = MongoClient(os.getenv('MONGODB_URI')); print('✓ MongoDB connected'); print(client.list_database_names())"
```

### Test Synthesis Architect:
```bash
source venv/bin/activate
python backend/synthesis_architect.py
```

### Test LangGraph Manager:
```bash
source venv/bin/activate
python run_workflow.py
```

### Test Full Integration:
```bash
source venv/bin/activate
python run_integrated_workflow.py
```

## Troubleshooting

### MongoDB Authentication Failed
- Verify username and password in connection string
- Check IP whitelist in MongoDB Atlas (allow your IP or 0.0.0.0/0)
- Ensure user has read/write permissions on databases

### Gemini API Error
- Verify API key is correct in `.env.local`
- Check quota/billing in Google AI Studio
- Ensure `google-genai` package is installed

### DeepSeek/Fireworks Error
- Verify Fireworks API key is correct
- Model must be `accounts/fireworks/models/deepseek-v3p2`
- Check API quota on Fireworks dashboard

## Next Steps

1. Populate Knowledge Graph with concepts:
```python
from pymongo import MongoClient
client = MongoClient("your_mongodb_uri")
db = client["AcademicPlanner"]
db["Knowledge_Graph"].insert_one({
    "name": "Machine Learning Basics",
    "description": "Introduction to ML algorithms",
    "timestamp": "2026-01-10"
})
```

2. Run Synthesis Architect to generate proposals
3. Run integrated workflow to rank and prioritize
4. View results in MongoDB or logs

## Architecture Benefits

- **Modular**: Each agent can run independently
- **Scalable**: MongoDB Atlas handles concurrent access
- **Intelligent**: Uses multiple LLMs for different tasks
- **Observable**: Full logging and state tracking
- **Extensible**: Easy to add new agents or collections
